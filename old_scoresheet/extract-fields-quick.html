<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extract PDF Fields</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover {
      background: #2563eb;
    }
    #output {
      margin-top: 20px;
      padding: 15px;
      background: #2a2a2a;
      border-radius: 6px;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 12px;
    }
    .success {
      color: #22c55e;
    }
    .error {
      color: #ef4444;
    }
  </style>
</head>
<body>
  <h1>Extract PDF Fields</h1>
  <p>Click the button to extract all form fields from matchblatt_fillable.pdf</p>
  
  <button id="extractBtn">Extract PDF Fields</button>
  
  <div id="output"></div>

  <script type="module">
    // Import pdf-lib
    let PDFDocument = null;
    
    async function loadPdfLib() {
      if (!PDFDocument) {
        try {
          const pdfLib = await import('https://cdn.skypack.dev/pdf-lib@1.17.1');
          PDFDocument = pdfLib.PDFDocument;
          console.log('PDF-lib loaded successfully');
        } catch (e) {
          throw new Error(`Failed to load PDF-lib: ${e.message}`);
        }
      }
      return PDFDocument;
    }

    document.getElementById('extractBtn').addEventListener('click', async () => {
      const output = document.getElementById('output');
      output.innerHTML = '<p>Loading PDF and extracting fields...</p>';
      
      try {
        const PDFDoc = await loadPdfLib();
        
        const response = await fetch('matchblatt_fillable.pdf');
        if (!response.ok) {
          throw new Error(`Failed to load PDF: ${response.statusText}`);
        }
        const arrayBuffer = await response.arrayBuffer();
        
        const pdfDoc = await PDFDoc.load(arrayBuffer);
        const form = pdfDoc.getForm();
        const fields = form.getFields();
        
        const mapping = {
          metadata: {
            extractedAt: new Date().toISOString(),
            totalFields: fields.length,
            pdfFile: 'matchblatt_fillable.pdf'
          },
          fields: []
        };
        
        fields.forEach(field => {
          const fieldName = field.getName();
          const fieldType = field.constructor.name;
          
          mapping.fields.push({
            name: fieldName,
            type: fieldType
          });
        });
        
        // Sort by name
        mapping.fields.sort((a, b) => a.name.localeCompare(b.name));
        
        // Download mapping file
        const blob = new Blob([JSON.stringify(mapping, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'pdf-field-mapping.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        output.innerHTML = `
          <p class="success">âœ“ Extracted ${fields.length} fields!</p>
          <p>File downloaded: pdf-field-mapping.json</p>
          <p>Field names:</p>
          <div>${mapping.fields.map(f => `${f.name} (${f.type})`).join('\n')}</div>
        `;
      } catch (error) {
        console.error('Error:', error);
        output.innerHTML = `<p class="error">Error: ${error.message}</p>`;
      }
    });
  </script>
</body>
</html>

